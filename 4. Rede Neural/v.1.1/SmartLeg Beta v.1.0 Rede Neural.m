function [y1,xf1] = myNeuralNetworkFunction1(x1,xi1)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 19-Oct-2017 16:49:06.
% 
% [y1,xf1] = myNeuralNetworkFunction(x1,xi1) takes these arguments:
%   x = 2xTS matrix, input #1
%   xi1 = 2x5 matrix, initial 5 delay states for input #1.
% and returns:
%   y = 1xTS matrix, output #1
%   xf1 = 2x5 matrix, final 5 delay states for input #1.
% where TS is the number of timesteps.

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [65.01;-158.54];
  x1_step1_gain = [0.0404122044857547;0.00489380444357444];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-1.0933360263863152;-0.73098431788070206;-1.9471091722320293;-1.3187605776510181;-0.61573288019864225;0.12616758496331026;1.842034187007493;0.93412774026091316;-1.2303884879276172;-0.63649212751172535;-0.37235768494151317;0.40685930827948719;0.69735867063901524;-0.6434834180356046;-0.18281857775848517;-0.2194915115538334;-0.032406498402262701;-0.71676284026048043;0.73046788720620215;-0.38711435113092407;0.65057001435675132;1.1303894424173913;1.015749470960728;1.0050822229302334;-0.64897647864010821];
  IW1_1 = [1.0044679077592693 1.6825797792649499 0.67987927174248208 -0.87567673865109974 0.80901481678514742 -1.3678150460543486 -0.0043048417260712572 0.36915698877877329 -0.52636995928655628 -0.34905339149427733;-0.48794388906253433 -0.11008533681026079 -1.9620189522122018 0.58307546378566821 -2.3096990259327415 0.76939052749131409 0.5659676011929794 0.38106145812511327 2.7920326033140075 0.56457379726029933;-0.29564631753918613 -1.3207321266490015 -0.45821474530019402 -0.8794148133869838 -0.14530943215048112 -0.78570070904565648 1.5905685442400885 -0.82315608370708404 1.0790610598314334 -1.0609020470375032;0.13324164573224642 -1.2176685414482844 -0.11359552725884776 -0.96464474983955184 -0.24541100714014996 -1.0307909996143054 -0.61660430250751486 -0.37799913468450153 1.7977464761598789 -0.18293065239179365;-0.8213540068378018 -0.86282280900922304 -1.4796658394384219 0.52567699418498526 -0.055530513582996828 0.58230395136323621 -0.055999942910995595 0.30660276295958849 0.0086965614558382146 0.78922574715056804;0.16254488255762584 0.71106481149414724 -1.276869818556831 0.72072190706233441 -0.13613277345644553 2.1099982056445903 0.7434702787919919 -0.28945280946236801 0.44417730622715418 -0.86797306950649078;1.9556146541855308 -0.089577142278063945 0.34895453368891349 -0.41698256777432025 0.11787526311081278 0.26051608024716505 0.38472366161108223 -0.55962593527314997 -0.16683066710028829 1.9286251488590407;-1.5028358989472899 -0.37661884396780604 0.59417962494584875 2.0045854427306571 -0.25478243738239237 1.0163680501381962 0.49474873451498197 -1.465506116523787 1.2292279039058596 0.033407393726750154;1.7587147752765546 -1.5810533146899011 -0.1331053762316062 -1.6712260921812918 -0.25145592227019098 -0.98638255784104534 -1.1143416864502544 -0.52316019358262156 0.04478468796273892 -0.99983619331157225;0.23075987941567472 0.13727405333522341 0.36130410719750572 2.0424460703266929 -1.2670713387032821 -0.74806162774544604 -0.78850010526423009 0.57150252357540721 -1.3586609459394283 -1.7788304898610483;-0.4394012452447813 2.3964343948075459 -0.025920646603827951 -0.3937257422144636 0.18208572575856627 -0.13829789580771282 -0.57576049423883402 1.0094064123920072 -1.0602704941982781 -1.6592003612626287;0.011344506574718924 0.12745867530244087 0.45323158128220131 0.45219371696812422 -1.4902051072386928 -1.4315408446509643 1.0011631148724025 0.77974868285542986 0.41905102944825784 0.92524055524448667;0.90376791175541327 0.6988487898607475 -0.99133774854977752 0.8909178355488675 0.31889040005374542 -0.0041511877404366666 0.63281550173467505 -0.24358328833975726 -1.1329593765324908 -0.1988030434816617;-0.028317214554698964 -0.84284635053016632 0.40752621492898045 -0.35274621414126278 -1.4103285086993023 -1.2914490227450244 -0.90021854042359772 -0.22490193138107048 1.6535416934644549 -0.46630407765834964;-1.1696270217588971 -1.3550079418715228 0.6496941513791209 -0.26863336666853649 -0.49809302623010993 2.0423206455770897 1.6171763969787933 -0.9238793263905638 -0.44985098232703746 -0.23369198972385108;-2.1932207886866992 -0.33954322250349234 0.96526360113563769 0.51603570937391163 0.44576448140623726 -0.6387763219334297 -0.95958568021735746 0.22301696430628765 0.60308986841523493 -2.4514921821653863;0.30556341547076765 -0.61386636394325023 0.98787254478382069 -1.0059903520522475 2.2029105441758232 0.46490263986136005 -0.3946225147481543 0.032280812169193589 -1.5956494611591461 0.24893452653345624;0.75667697466708639 0.031591827612180892 -1.2475054571269468 -0.59066988385522368 -0.13125932143009203 0.30058600444173911 1.0150328067740655 -0.07098052296681763 -2.0253755149148351 -1.7805227398831902;0.89761649049191228 -0.30009314482980548 0.34960489571548337 1.0417897520467081 -1.7543715706037755 0.043627534033958713 -0.7428569869357422 -0.59995415412630415 2.6035477017276518 1.0454036384499608;-0.13762100397119786 0.7654886343010282 0.43147844732296536 0.80781919825013959 -0.18127552371700556 -0.64864285001421773 -1.3387112130376444 0.064750604042512552 -0.41769252135336299 -0.48076044031500575;2.7022714575302005 -0.11818490315737419 -0.32941465884018539 0.32640320182235716 -1.6760271872995938 -1.3918667669647724 -2.0005737982889169 0.058325526635482926 2.7142396632611683 0.45093280996737506;-1.0079975473241001 1.4998102166298239 -0.81687257552265635 1.8720621488655003 0.24339393244419028 1.0742929090876301 -0.38340542919532888 0.40078668299914744 1.0541912806171787 -0.2784769515826987;-1.0105850079030427 -0.57807871744190509 -0.80959354441359177 0.42846452061130608 0.49148409116520725 1.6348185022392214 -1.8219636058236675 -0.63678972357506725 2.4999259967310659 0.35331904604564401;-0.15678242590440583 -0.13812635239039872 0.40282132619450578 0.2981894983427345 -1.176600424962746 -0.50464715137434923 0.20642055241084359 0.12169275256987702 -0.57803257593125656 -1.0731995006921051;0.016926676177765585 -0.35925353699902135 -0.20974099468334206 0.28451332000598156 0.6733080404274554 -0.95312746450241437 -0.32642802303897728 0.4914633372941497 -1.0241270442911214 -3.2864066037016211];
  
  % Layer 2
  b2 = 0.03921925849020548;
  LW2_1 = [-1.2362428652015662 -2.2605061572037775 0.82155411223794628 -2.9029000403756933 1.9097307866518052 1.5833438694148299 1.6838951056249503 1.5825210275277051 -1.7284788142557308 1.030483323514394 0.9419682365655353 -2.3839720316256483 -2.277944909631807 3.2344352485112702 -1.3917007852984598 -1.79607663411175 -2.0401364127989274 -2.0741055004824465 -2.4271546087550058 -3.3345068448130757 1.5414084898015472 -1.6686118529577487 -2.1338325039526929 -2.040633752857925 1.2087106869871265];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 0.0274386061188092;
  y1_step1_xoffset = -7.61;
  
  % ===== SIMULATION ========
  
  % Dimensions
  TS = size(x1,2); % timesteps
  
  % Input 1 Delay States
  xd1 = mapminmax_apply(xi1,x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
  xd1 = [xd1 zeros(2,1)];
  
  % Allocate Outputs
  y1 = zeros(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Rotating delay state position
    xdts = mod(ts+4,6)+1;
  
    % Input 1
    xd1(:,xdts) = mapminmax_apply(x1(:,ts),x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    tapdelay1 = reshape(xd1(:,mod(xdts-[1 2 3 4 5]-1,6)+1),10,1);
    a1 = tansig_apply(b1 + IW1_1*tapdelay1);
    
    % Layer 2
    a2 = b2 + LW2_1*a1;
    
    % Output 1
    y1(:,ts) = mapminmax_reverse(a2,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final delay states
  finalxts = TS+(1: 5);
  xits = finalxts(finalxts<=5);
  xts = finalxts(finalxts>5)-5;
  xf1 = [xi1(:,xits) x1(:,xts)];
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
